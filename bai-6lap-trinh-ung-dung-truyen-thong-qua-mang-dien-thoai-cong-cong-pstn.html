<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Bài 6:LẬP TRÌNH ỨNG DỤNG TRUYỀN THÔNG QUA MẠNG ĐIỆN THOẠI CÔNG CỘNG (PSTN)   - My Blog</title><meta name="description" content="KỸ THUẬT LẬP TRÌNH VỚI JTAPI 1. Giới thiệu thư viện JTAPI JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://github.com/conglam03/myblog.git/bai-6lap-trinh-ung-dung-truyen-thong-qua-mang-dien-thoai-cong-cong-pstn.html"><link rel="alternate" type="application/atom+xml" href="https://github.com/conglam03/myblog.git/feed.xml"><link rel="alternate" type="application/json" href="https://github.com/conglam03/myblog.git/feed.json"><meta property="og:title" content="Bài 6:LẬP TRÌNH ỨNG DỤNG TRUYỀN THÔNG QUA MẠNG ĐIỆN THOẠI CÔNG CỘNG (PSTN)  "><meta property="og:site_name" content="My Blog"><meta property="og:description" content="KỸ THUẬT LẬP TRÌNH VỚI JTAPI 1. Giới thiệu thư viện JTAPI JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho&hellip;"><meta property="og:url" content="https://github.com/conglam03/myblog.git/bai-6lap-trinh-ung-dung-truyen-thong-qua-mang-dien-thoai-cong-cong-pstn.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://github.com/conglam03/myblog.git/assets/css/style.css?v=94220f119044674b7663d7c550454968"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/conglam03/myblog.git/bai-6lap-trinh-ung-dung-truyen-thong-qua-mang-dien-thoai-cong-cong-pstn.html"},"headline":"Bài 6:LẬP TRÌNH ỨNG DỤNG TRUYỀN THÔNG QUA MẠNG ĐIỆN THOẠI CÔNG CỘNG (PSTN)  ","datePublished":"2024-12-26T13:27+07:00","dateModified":"2024-12-26T14:11+07:00","description":"KỸ THUẬT LẬP TRÌNH VỚI JTAPI 1. Giới thiệu thư viện JTAPI JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho&hellip;","author":{"@type":"Person","name":"conlam03","url":"https://github.com/conglam03/myblog.git/authors/conlam03/"},"publisher":{"@type":"Organization","name":"conlam03"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://github.com/conglam03/myblog.git/">My Blog</a></header><main class="post"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>Bài 6:LẬP TRÌNH ỨNG DỤNG TRUYỀN THÔNG QUA MẠNG ĐIỆN THOẠI CÔNG CỘNG (PSTN)  </h1><div class="feed__meta content__meta"><a href="https://github.com/conglam03/myblog.git/authors/conlam03/" class="feed__author">conlam03</a> <time datetime="2024-12-26T13:27" class="feed__date">December 26, 2024</time></div></div></header></div><div class="entry-wrapper content__entry"><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><table><tbody><tr><td width="312"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><table><tbody><tr><td width="369"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><table><tbody><tr><td width="275"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><table><tbody><tr><td width="251"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><table><tbody><tr><td width="179"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><table><tbody><tr><td width="369"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><table><tbody><tr><td width="408"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><table><tbody><tr><td width="312"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><table><tbody><tr><td width="274"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><table><tbody><tr><td width="388"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><table><tbody><tr><td width="312"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><table><tbody><tr><td width="274"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><table><tbody><tr><td width="275"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><table><tbody><tr><td width="251"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><table><tbody><tr><td width="513"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><table><tbody><tr><td width="253"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><table><tbody><tr><td width="179"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><table><tbody><tr><td width="369"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><table><tbody><tr><td width="408"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><table><tbody><tr><td width="388"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><table><tbody><tr><td width="312"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><table><tbody><tr><td width="274"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><table><tbody><tr><td width="275"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><table><tbody><tr><td width="251"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><table><tbody><tr><td width="513"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><table><tbody><tr><td width="253"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><table><tbody><tr><td width="179"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><table><tbody><tr><td width="369"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><table><tbody><tr><td width="408"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><table><tbody><tr><td width="388"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><table><tbody><tr><td width="312"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><table><tbody><tr><td width="274"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><table><tbody><tr><td width="275"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><table><tbody><tr><td width="251"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><table><tbody><tr><td width="513"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><table><tbody><tr><td width="253"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><table><tbody><tr><td width="179"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><table><tbody><tr><td width="369"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><table><tbody><tr><td width="408"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><p> </p><p> </p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p><ol><li><strong></strong><strong>KỸ THUẬT LẬP TRÌNH VỚI JTAPI</strong></li></ol><h5>1.   Giới thiệu thư viện JTAPI</h5><p>JTAPI là một giao diện lập trình ứng dụng hướng đối tượng cho những ứng dụng máy tính-điện thoại trên nền Java. Tương tự như những giao diện lập trình ứng dụng cho các nền tảng khác như TAPI (Telephony API) trên Microsoft Windows và TSAPI trên Novell Netware. Cấu trúc của thư viện JTAPI được thể hiện như hình sau: Nó gồm bộ cốt lõi và các gói mở rộng chuẩn.</p><table><tbody><tr><td width="388"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.1. Cấu trúc thư viện JTAPI</p><p>Tại trung tâm của JTAPI là gói "cốt lõi ". Gói cốt lõi cung cấp khung cơ bản cho mô hình gọi điện thoại và những đặc trưng điện thoại sơ khai ban đầu . Những đặc tính này bao gồm định vị một cuộc gọi, trả lời một gọi, và huỷ một cuộc gọi. Những ứng dụng kỹ thuật điện thoại đơn giản sẽ chỉ cần sử dụng lõi để thực hiện các tác vụ của chúng mà không cần quan tâm tới những chi tiết của những gói khác. Chẳng hạn, gói lõi cho phép người sử dụng dễ dàng thiết kế để thêm đặc tính điện thoại vào một trang Web.</p><p>Phân tầng xung quanh gói lõi JTAPI là một số gói "mở rộng chuẩn ". Những gói mở rộng này bổ sung thêm các chức năng điện thoại cho API. Các gói mở rộng chuẩn trong API bao gồm các gói sau:<em>callcontrol, callcenter, media, phone, privatepackages </em>và gói <em>capabilities.</em></p><ul><li><em>Gói điều khiển gọi – call</em></li></ul><p>Gói <em>javax.telephony.callcontrol</em>: Mở rộng lõi bằng việc cung cấp các cuộc gọi mức cao hơn bao gồm các đặc tính điều khiển điện thoại như giữ cuộc gọi, chuyển cuộc gọi... Gói này cũng cung cấp một mô hình trạng thái chi tiết hơn của những cuộc gọi. Các lớp tiêu biểu của gói gồm các giao diện sau:</p><ul><li><u>CallControlAddress</u></li><li><u>CallControlAddressObserver</u></li></ul><p> </p><ul><li><u>CallControlCall</u></li><li><u>CallControlCallObserver</u></li><li><u>CallControlConnection</u></li><li><u>CallControlTerminal</u></li><li><u>CallControlTerminalConnection</u></li><li><u>CallControlTerminalObserver</u></li></ul><ul><li><em>Gói callcenter</em></li></ul><p>Gói <em>javax.telephony.callcenter </em>cung cấp khả năng thực hiện quản lý các trung tâm cuộc gọi lớn ở mức độ cao. Ví dụ như: định tuyến, phân bố cuộc gọi tự động ACD, dự báo cuộc gọi và liên kết dữ liệu ứng dụng với đối tượng điện thoại. Gói này gồm các lớp sau:</p><ul><li><u>ACDAddress</u></li><li><u>ACDAddressObserver</u></li><li><u>ACDConnection</u></li><li><u>ACDManagerAddress</u></li><li><u>ACDManagerConnection</u></li><li><u>AgentTerminal</u></li><li><u>AgentTerminalObserver</u></li><li><u>CallCenterAddress</u></li><li><u>CallCenterCall</u></li><li><u>CallCenterCallObserver</u></li><li><u>CallCenterProvider</u></li><li><u>RouteAddress</u></li><li><u>RouteCallback</u></li><li><u>RouteSession</u></li></ul><ul><li><em>Gói</em></li></ul><p>Gói <em>javax.telephony.media </em>cho phép truy nhập tới các luồng(stream) phương tiện truyền thông liên quan đến cuộc gọi. Chúng cho phép đọc và viết dữ liệu từ những luồng phương tiện truyền thông này. Gói này gồm các lớp:</p><ul><li><u>MediaCallObserver</u></li></ul><p>□ <u>MediaTerminalConnection</u></p><ul><li><em>Gói Phone:</em></li></ul><p>Gói <em>javax.telephony.phone </em>cho phép các ứng dụng  điều khiển các đặc tính vật lý của</p><p>phần cứng điện thoại.</p><p>Gói Phone gồm các lớp:</p><ul><li><u>Component</u></li><li><u>ComponentGroup</u></li><li><u>PhoneButton</u></li><li><u>PhoneDisplay</u></li><li><u>PhoneGraphicDisplay</u></li><li><u>PhoneHookswitch</u></li><li><u>PhoneLamp</u></li></ul><p> </p><ul><li><u>PhoneMicrophone</u></li><li><u>PhoneRinger</u></li><li><u>PhoneSpeaker</u></li><li><u>PhoneTerminal</u></li><li><u>PhoneTerminalObserver</u></li><li><em>Gói capabilities :</em></li></ul><p>Gói <em>javax. telephony.capabilities </em>là gói cung cấp cho các ứng dụng khả năng truy vấn tới hoạt động xác định một khi nó được thực hiện. Và nó gồm các lớp sau :</p><ul><li><u>AddressCapabilities</u></li><li><u>CallCapabilities</u></li><li><u>ConnectionCapabilities</u></li><li><u>ProviderCapabilities</u></li><li><u>TerminalCapabilities</u></li><li><u>TerminalConnectionCapabilities</u></li></ul><ul><li><em>Gói Private Data</em></li></ul><p>Gói <em>javax.telephony.privatedata </em>cho phép các ứng dụng truyền trực tiếp dữ liệu trên các chuyển mạch cứng. Dữ liệu này được sử dụng để chỉ dẫn chuyển mạch thực hiện một thao tác chuyển mạch cụ.</p><h5>2.   Cơ sở của JTAPI.</h5><p>Mục đích của thư viện JTAPI được xây dựng để tạo ra một giao diện cho phép trình ứng dụng Java giao tiếp với hệ thống điện thoại<em>. </em>Điểm giao tiếp này xác định mức độ điều khiển mà một ứng dụng phải có. JTAPI hỗ trợ cả 2 kiểu ứng dụng: first-party và third-party.</p><table><tbody><tr><td width="312"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>Trong ứng dụng first- party, giao diện được định vị tại thiết bị đầu cuối. Ứng dụng có cùng mức độ điều khiển như cuộc gọi điện thoại bình thường của người dùng. Trong kịch bản điều khiển third –party, giao diện được xác định bên trong hệ thống điện thoại và phụ thuộc vào hệ thống điện thoại. Sự truy cập bên trong này thường cung cấp cho ứng dụng nhiều khả năng điều khiển hơn kịch bản first- party.</p><p>Hình 6.2. Điều khiển cuộc gọi</p><p>JTAPI trong thực tế, thực chất là một tập API. Bộ cốt lõi của API cung cấp mô hình cuộc gọi cơ bản và những đặc trưng điện thoại cơ sở nhất như: định vị cuộc gọi và trả lời các cuộc gọi telephone.</p><p>Các đặc trưng của điện thoại Java là:</p><p> </p><ul><li>Làm đơn giản hầu hết các ứng dụng điện thoại cơ bản</li><li>Cung cấp một khung làm việc mà trải khắp các ứng dụng desktop đối với các ứng dụng điện thoại trung tâm gọi phân tán.</li><li>Giao tiếp các ứng dụng trực tiếp với các nơi cung cấp dịch vụ hoặc thực hiện giao tiếp với các API điện thoại tồn tại sẵn như SunXTL, TSAPI, and TAPI.</li><li>Dựa trên bộ lõi đơn giản, gia tăng thêm các gói mở rộng chuẩn.</li><li>Chạy được trên một phạm vi rộng các cấu hình phần cứng một khi Java run-time được sử dụng.</li></ul><p> </p><h5><a name="_TOC_250009"></a>3.   Các cấu hình cuộc gọi tiêu biểu</h5><p>Mục này trình bày những ví dụ cấu hình cuộc gọi được lựa chọn để giải thích mô hình gọi. Nó được bắt đầu với một cuộc gọi 2 phía cơ bản, sau đó mở rộng ví dụ với cuộc gọi, người sử dụng và các thiết bị đầu cuối khác.</p><p><em>Cu</em><em>c</em><em> </em><em>g</em><em>i</em><em> </em><em>2</em><em> </em><em>phía(two-</em><em> </em><em>party</em><em> </em><em>call):</em></p><p>Một ví dụ cuộc gọi với hai người tham gia được biểu diễn trong hình 6.3. Những người chưa có kinh nghiệm có thể rất ngạc nhiên trong trường hợp đơn giản này: hai đối tượng kết nối (<em>Connection object</em>) gắn vào đối tượng cuộc gọi (<em>Call object</em>), mỗi đối tượng kết nối cho mỗi người tham gia. Cấu hình này cho phép mở rộng để thực hiện cho cuộc gọi hội thảo với ba hoặc nhiều người tham gia hơn. Cần chú ý rằng mô hình này hoàn toàn cân đối (Nó không phân biệt giữa thực thể cục bộ và thực thể ở xa) bởi vì nó cung cấp cách nhìn third-party</p><table><tbody><tr><td width="274"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.3.. Mô hình two- party call</p><h5>Hai cuộc gọi đồng thời:</h5><p>Một ví dụ về một người sử dụng mà có hai cuộc gọi đồng loạt trên cùng thiết bị đầu cuối được đưa vào hình 6.4. Mọi đối tượng liên quan cuộc gọi đã gấp đôi số của họ. Đối tượng địa chỉ (<em>Address object</em>) và đối tượng thiết bị đầu cuối (<em>Terminal object</em>) của người sử dụng có hai cuộc gọi chỉ sinh ra một lần nhưng được gán cho hai đối tượng kết nối (<em>Connection object</em>) và hai đối tượng kết nối đầu cuối (<em>TerminalConnection</em>).</p><p> </p><p>Hình6.4. Mô hình Two simultaneous calls.</p><h5>Cài đặt cuộc gọi với hai thiết bị đầu cuối:</h5><p>Một ví dụ cuộc gọi hai người với thiết bị đầu cuối có chuông báo được trình bày trong hình 6.5. Trong ví dụ trên, Bob thực hiện nhiều luồng, có nghĩa rằng khi Bob được gọi thì vài thiết bị đầu cuối sẽ đổ chuônốngự thể hiện nhiều luồng được đại diện bởi hai đối tượng kết nối đầu cuối gắn cho kết nối đối tượng của Bob, mỗi đối tượng cho mỗi thiết bị đầu cuối. Khi một trong những thiết bị đầu cuối trả lời cuộc gọi thì thiết bị đầu cuối khác sẽ bị loại ra( trong giới hạn của mô hình cuộc gọi này, đối tượng kết nối đầu cuối được đặt vào trong một trạng thái cấm hoạt động)</p><table><tbody><tr><td width="275"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.5. Mô hình Two alerting terminal calls.</p><h5>Cuộc gọi 3 thành viên:</h5><p>Một ví dụ tiêu biểu cho cuộc gọi ba thành viên là cuộc gọi hội nghị với ba người tham gia được</p><p>thể hiện như hình 6.6. Mô hình cuộc gọi là một sự mở rộng trực tiếp từ mô hình cuộc gọi cơ bản</p><p> </p><p>với hai người tham gia. Mô hình đơn giản thêm một thành viên thứ ba với các đối tượng kết nối, địa chỉ, kết nối đầu cuối và thiết bị đầu cuối cho người thứ ba tham gia.</p><table><tbody><tr><td width="251"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.6. Mô hình Third-party call.</p><p> </p><h5>4.   <a name="_TOC_250008"></a>Mô hình cuộc gọi Java</h5><h6>4.1.     Nguyên tắc</h6><p>JTAPI là một mô hình trừu tượng hóa mức độ cao và độc lập về công nghệ. Nó mô tả cuộc gọi như là một tập hữu hạn trạng thái máy mà phải trải qua trạng thái chuyển tiếp đó khi cuộc gọi được thực hiện.</p><p>Mô hình cuộc gọi được xây dựng tổng quát, bao trùm nhiều kịch bản cuộc gọi khác nhau. Nó có</p><p>thể được mô tả bằng ví dụ chẳng hạn :</p><ul><li>Cuộc gọi giữa hai đối tác.</li><li>Nhiều cuộc gọi đồng loạt xảy ra trên cùng thiết bị đầu cuối.</li><li>Một cuộc hội thảo nhiều đối tác.</li><li>Cài đặt cuộc gọi để thông báo nhiều thiết bị đầu cuối.</li></ul><p>Mô hình cuộc gọi mô tả việc gọi cũng như những thành phần tham gia cuộc gọi. Tất cả nó định nghĩa trong 5 lớp cơ sở. Hai lớp mô tả những thành phần tham gia cuộc gọi. Những đối tượng duy trì và độc lập của cuộc gọi:</p><ul><li>Một người sử dụng (<em>user</em>) được đại diện bởi một đối tượng địa chỉ (<em>Address</em>). Thuộc tính</li></ul><p>chính của đối tượng địa chỉ là định danh người sử dụng (<em>user identifier</em>).</p><ul><li>Một điện thoại đầu cuối được đại diện cho bởi đối tượng đầu cuối (<em>Terminal</em>). Thuộc tính</li></ul><p>chính của đối tượng thiết bị đầu cuối là địa chỉ của thiết bị đó.</p><p>Ba lớp khác mô tả một cuộc gọi. Những đối tượng thể hiện của các lớp này không duy trì mà</p><p>được tạo ra động trong khi cuộc gọi xảy ra. Mỗi đối tượng bao gồm một trạng thái máy hữu hạn:</p><ul><li>Một đối tượng gọi (<em>Call</em>) được tạo ra cho mỗi cuộc gọi.</li></ul><p> </p><ul><li>Một đối tượng kết nối (<em>Connection</em>) được tạo ra cho mỗi người sử dụng tham gia vào cuộc gọi. Nó kết nối đối tượng địa chỉ của người sử dụng với đối tượng gọi.</li><li>Một đối tượng kết nối đầu cuối (<em>TerminalConnection</em>) được tạo ra cho mỗi thiết bị đầu cuối tham gia vào cuộc gọi. Nó kết nối đối tượng (<em>Terminal</em>) thiết bị đầu cuối với đối tượng kết nối (<em>Connection</em>).</li></ul><h6>4.2.     Các đối tượng trong mô hình gọi thoại java</h6><p>Các đối tượng trong mô hình gọi thoại Java được thể hiện như hình 6.7.</p><ul><li><strong>Đối tượng Provider</strong>: là một sự trừu tượng của phần mềm service-provider telephone. Provider có thể quản lý kết nối giữa PBX với server, một card telephony/fax trong máy desktop hoặc một công nghệ mạng máy tính như IP. Provider ẩn tất cả các chi tiết dịch vụ cụ thể của các hệ thống con telephone và cho phép ứng dụng Java hoặc Applet tương tác với các hệ thống con telephone trong cơ chế độc lập thiết bị.</li><li><strong>Đối tượng Call</strong>: Đối tượng này thể hiện một cuộc gọi điện thoại là luồng thông tin giữa người cung cấp dịch vụ và các thành viên của cuộc gọi. Một cuộc gọi điện thoại bao gồm một đối tượng Call và không hoặc nhiều kết nối. Trong kiểu gọi two-party gồm một đối tượng Call và 2 kết nối, còn trong kiểu hội thảo thì có 3 hoặc nhiều hơn số kết nối với một đối tượng Call.</li><li><strong>Đối tượng Address</strong>: Đối tượng này biểu diễn một số điện thoại. Nó là sự trừu tượng đối với một điểm cuối logic của một cuộc gọi điện thoại. Trong thực tế một số điện thoại có thể tương ứng với một số điểm cuối vật lý.</li><li><strong>Đối tượng Connection</strong>: Một đối tượng Connection mô hình hoá liên kết truyền thông giữa đối tượng Call và đối tượng Address. Đối tượng Connection có thể ở trong một trong các trạng thái khác nhau chỉ thị trạng thái quan hệ hiện thời giữa Call và Address.</li></ul><p> </p><p> </p><p> </p><p>Hình 6.7. Mô hình cuộc gọi thoại Java</p><p> </p><ul><li><strong>Đối tượng Terminal</strong>: Biểu diễn một thiết bị vật lý như điện thoại và các thuộc tính gắn với nó. Mỗi đối tượng Terminal có một hoặc nhiều đối tượng Address( số điện thoại) gắn kết với nó. Terminal cũng được xem như là điểm cuối vật lý của một cuộc gọi vì nó tương ứng với một phần cứng vật lý.</li></ul><h6>§  Đi tng TerminalConnection: Th□ hi□n m□i quan h□ gi□a m□t k□t n□i và m□t đi□m cu□i v□t lý c□a m□t cu□c g□i mà đ□□c bi□u di□n b□i đ□i t□□ng Terminal. Đ□i tu□ng này mô t□ tr□ng thái hi□n th□i c□a m□i quan h□ gi□a đ□i t□□ng Connection và Terminal c□ th□.</h6><ul><li>Các phng thc gói ct lõi JTAPI</li></ul><p><strong><em>Gói</em></strong><strong><em> </em></strong><strong><em>c□t</em></strong><strong><em> </em></strong><strong><em>lõi</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>JTAPI</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>nghĩa</em></strong><strong><em> </em></strong><strong><em>3</em></strong><strong><em> </em></strong><strong><em>ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c</em></strong><strong><em> </em></strong><strong><em>h□</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>các</em></strong><strong><em> </em></strong><strong><em>đ□c</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>c□</em></strong><strong><em> </em></strong><strong><em>b□n:</em></strong><strong><em> </em></strong><strong><em>Thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c g□i,</em></strong><strong><em> </em></strong><strong><em>tr□</em></strong><strong><em> </em></strong><strong><em>l□i</em></strong><strong><em> </em></strong><strong><em>cu□c g□i</em></strong><strong><em> </em></strong><strong><em>và hu□</em></strong><strong><em> </em></strong><strong><em>k□t n□i</em></strong><strong><em> </em></strong><strong><em>c□a m□t cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong><strong><em> </em></strong><strong><em>Các ph□□ng</em></strong><strong><em> </em></strong><strong><em>th□c </em></strong><strong><em>t□□ng □ng v□i các tác v□ này là </em></strong><strong>Call.connect(), TerminalConnection.answer(), Connection.disconnect().</strong></p><p><strong> </strong></p><ul><li>Phng thc connect():<strong><em>Khi</em></strong><strong><em> m□t □ng d□ng có đ□i t□□ng r□i( thu đ□□c thông qua ph□□ng th□c </em>Provider.createCall())<em>,</em><em> nó có th□ thi□t l□p m□t cu□c g□i đi□n tho□i</em></strong></li></ul><p> </p><h6>b□ng cách s□ d□ng ph□□ng th□c Call.connect(). □ng d□ng ph□i ch□ ra ddoois t□□ng Terminal ngu□n( đi□m cu□i v□t lý) và đ□i t□□ng Address ngu□n( đi□m cu□i logic) trên Terminal đó. Nó cũng cung c□p m□t chu□i s□ đi□n tho□i đích. Hai đ□i t□□ng Connection đ□□c tr□ v□ t□ ph□□ng th□c Call.connect() bi□u di□n các đ□u cu□i ngu□n và đích c□a m□t cu□c g□i đi□n tho□i.</h6><ul><li>answer(): <strong><em>Khi m□t cu□c g□i đi t□i m□t Terminal, nó s□ đ□□c ch□ th□ b□i đ□i t□□ng TerminalConnection đ□i v□i Terminal đó trong tr□ng thái RINGING. </em></strong><strong><em>T□i th□i đi□m đó, □ng d□ng s□ g□i ph□□ng th□c </em>TerminalConnection.answer() <em>đ□ tr□ l□i cu□c g□i t□i đó.</em></strong></li></ul><h6>§  Connection.disconnect(): Ph□□ng th□c này đ□□c g□i đ□ lo□i b□ Address t□ m□t cu□c tho□i. Đ□i t□□ng Connection bi□u di□n quan h□ đ□i t□□ng Address v□i cu□c g□i đi□n tho□i. □ng d□ng s□ g□i ph□□ng th□c này khi đ□i t□□ng Connection đang □ tr□ng thái CONNECTED và tr□ v□ k□t qu□ là đ□i t□□ng Connetction chuy□n đ□n tr□ng thái DISCONNECTED.</h6><p><strong><em> </em></strong></p><ul><li><strong><em></em></strong><strong><em>Những trạng thái máy hữu hạn</em></strong><ul><li><em></em><em>Đối tượng cuộc gọi</em></li></ul></li></ul><p>Mỗi đối tượng cuộc gọi được tạo ra mỗi khi thực hiện cuộc gọi. Trạng thái của đối tượng cuộc</p><table><tbody><tr><td width="513"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p><br>gọi phụ thuộc vào mã số của đối tượng kết nối và nó gồm các trạng thái thể hiện như hình 6.8.</p><p>Hình 6.8. Đối tượng gọi.</p><p><em>Trạng thái nhàn rỗi(IDLE): </em>Đây là trạng thái khởi đầu cho mọi cuộc gọi. Trong trạng thái này, cuộc gọi không có kết nối nào.</p><p><em>Hoạt động(Active):</em>Đây trạng thái khi một cuộc gọi đang xẩy ra.Các cuộc gọi với một hoặc nhiều</p><p>kết nối đều phải ở trong trạng thái này.</p><p> </p><p><em>Vô hiệu hóa(Invalid):</em>Đây là trạng thái cuối cùng cho mọi cuộc gọi. Cuộc gọi mà mất tất cả các đối tượng kết nối (thông qua một sự chuyển tiếp của đối tượng kết nối vào trong kết nối - trạng thái ngưng kết nối) sẽ chuyển vào trong trạng thái này. Các cuộc gọi khi ở trong trạng thái này sẽ không có kết nối nào và những đối tượng cuộc gọi này có thể không được sử dụng cho bất kỳ hoạt động nào trong tương lai.  <em>2.4.1. Các trạng thái đối tượng Connection</em></p><p> </p><h5>4.4.2. Các trng thái đi tng Connection và đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>có</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>đ□□c</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>nh□ </em></strong><strong><em>hình 6.9. Nó g□m các tr□ng thái sau:</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE: <strong>Đây là tr□ng thái kh□i t□o ban đ□u c□a t□t c□ các đ□i t□□ng Connection m□i.</strong></em></li><li><em>INPROGRESS:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đã</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i </em></strong><strong><em>đích.</em></strong></li><li><em>ALERTING: <strong>Ch□ th□ phía đích c□a cu□c g□i đã c□nh báo m□t cu□c g□i t□i.</strong></em></li><li><em>CONNECTED: <strong>Ch□</strong></em><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng thái đ□wcj k□t</em></strong><strong><em> </em></strong><strong><em>n□i c□a</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>đi□n tho□i</em></strong></li><li><em>DISCONNECTED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> k□t thúc cu□c g□i.</em></strong></li><li><em>FAILED:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>l□i,</em></strong><strong><em> </em></strong><strong><em>ví</em></strong><strong><em> </em></strong><strong><em>d□</em></strong><strong><em> </em></strong><strong><em>k□t</em></strong><strong><em> </em></strong><strong><em>n□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>m□t phía</em></strong><strong><em> </em></strong><strong><em>đang</em></strong><strong><em> </em></strong><strong><em>b□n.</em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>r□ng đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng Provider không th□</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh đ□□c</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng </em></strong><strong><em>Connection</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>hi□n th□i.</em></strong></li></ul><p><strong><em> </em></strong></p><table><tbody><tr><td width="253"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.9. L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>Connection</em></strong></p><h5><em>4.4.3. </em>Các trng thái đi tng TerminalConnection</h5><p><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>d□ch chuy□n tr□ng thái c□a</em></strong><strong><em> </em></strong><strong><em>đ□i t□□ng TerminalConnection th□</em></strong><strong><em> </em></strong><strong><em>hi□n nh□</em></strong><strong><em> </em></strong><strong><em>hình 6.10.</em></strong></p><p><strong><em> </em></strong></p><ul><li><em>IDLE:</em><em> </em><strong><em>Tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>kh□i</em></strong><strong><em> </em></strong><strong><em>t□o</em></strong><strong><em> </em></strong><strong><em>ban</em></strong><strong><em> </em></strong><strong><em>đ□u</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>m□i</em></strong><strong><em> </em></strong><strong><em>đ□i</em></strong><strong><em> </em></strong><strong><em>t□□ng</em></strong><strong><em> TerminalConnection</em></strong></li><li><em>ACTIVE: <strong>Ch□ th□ Terminal là ph□n kích ho□t c□a m□t cu□c g□i đi□n tho□i.</strong></em></li><li><em>RINGING:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□ r□ng</em></strong><strong><em> </em></strong><strong><em>m□t</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>báo tín</em></strong><strong><em> </em></strong><strong><em>hi□u cho</em></strong><strong><em> </em></strong><strong><em>ng□□i</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>d□ng</em></strong><strong><em> </em></strong><strong><em>có cu□c g□i </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>t□i</em></strong><strong><em> </em></strong><strong><em>Terminal</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i.</em></strong></li><li><em>DROPPED: <strong>Ch□ th□ tr□ng thái b□ d□t cu□c g□i</strong></em></li><li><em>PASSIVE:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>kích</em></strong><strong><em> </em></strong><strong><em>ho□t</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em></em></strong></li><li><em>UNKNOWN:</em><em> </em><strong><em>Ch□</em></strong><strong><em> </em></strong><strong><em>th□</em></strong><strong><em> </em></strong><strong><em>provider</em></strong><strong><em> </em></strong><strong><em>không</em></strong><strong><em> </em></strong><strong><em>cho</em></strong><strong><em> </em></strong><strong><em>phép</em></strong><strong><em> </em></strong><strong><em>xác</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>tr□ng</em></strong><strong><em> </em></strong><strong><em>thái</em></strong><strong><em> </em></strong><strong><em>hi□n</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong></li></ul><p> </p><p><strong><em> </em></strong></p><p><strong><em>Hình 6.10. L□□c đ□ d□ch</em></strong><strong><em> </em></strong><strong><em>chuy□n tr□ng thái c□a</em></strong><strong><em> TerminalConnection</em></strong></p><ul><li>Thit đt mt cuc gi đin thoi</li></ul><p><strong><em>Ph□n</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>t□</em></strong><strong><em> </em></strong><strong><em>s□</em></strong><strong><em> </em></strong><strong><em>thay đ□i tr□ng</em></strong><strong><em> </em></strong><strong><em>thái c□a</em></strong><strong><em> </em></strong><strong><em>toàn</em></strong><strong><em> </em></strong><strong><em>b□</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i ph□i tr□i qua</em></strong><strong><em> </em></strong><strong><em>khi thi□t</em></strong><strong><em> </em></strong><strong><em>đ□t m□t cu□c g□i đi□n</em></strong><strong><em> </em></strong><strong><em>tho□i đ□n gi□n.</em></strong><strong><em> </em></strong><strong><em>Quá trình này có th□ đ□□c th□ hi□n b□ng</em></strong><strong><em> </em></strong><strong><em>m□t l□□c đ□</em></strong><strong><em> </em></strong><strong><em>đ□nh</em></strong><strong><em> </em></strong><strong><em>th□i</em></strong><strong><em> </em></strong><strong><em>mô</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>nh□</em></strong><strong><em> </em></strong><strong><em>hình</em></strong><strong><em> </em></strong><strong><em>6.11.</em></strong></p><table><tbody><tr><td width="179"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p><strong><em>Hình 6.11. L□□c đ□ đ□nh th□i mô hình cu□c g□i</em></strong></p><p><strong><em>Trong l□□c đ□ trên, các b□□c th□i gian r□i r□c b□i các s□ nguyên</em></strong><strong><em> </em></strong><strong><em>h□□ng xu□ng theo tr□c tung. </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>bi□u di□n m□t</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>đ□n gi□n ki□u two-party.</em></strong><strong><em> </em></strong><strong><em>L□□c</em></strong><strong><em> </em></strong><strong><em>đ□</em></strong><strong><em> </em></strong><strong><em>này</em></strong><strong><em> </em></strong><strong><em>chia</em></strong><strong><em> </em></strong><strong><em>làm</em></strong><strong><em> </em></strong><strong><em>2 </em></strong><strong><em>ph□n,</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a</em></strong><strong><em> </em></strong><strong><em>ph□i.</em></strong><strong><em> </em></strong><strong><em>N□a</em></strong><strong><em> </em></strong><strong><em>trái</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>ngu□n</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i</em></strong><strong><em> </em></strong><strong><em>và</em></strong><strong><em> </em></strong><strong><em>n□a </em></strong><strong><em>ph□i</em></strong><strong><em> </em></strong><strong><em>bi□u</em></strong><strong><em> </em></strong><strong><em>di□n</em></strong><strong><em> </em></strong><strong><em>đi□m</em></strong><strong><em> </em></strong><strong><em>cu□i</em></strong><strong><em> </em></strong><strong><em>đích</em></strong><strong><em> </em></strong><strong><em>c□a</em></strong><strong><em> </em></strong><strong><em>cu□c</em></strong><strong><em> </em></strong><strong><em>g□i.</em></strong></p><h4><a name="_TOC_250007"></a>II.      CẤU HÌNH HỆ THỐNG</h4><p> </p><p>JTAPI chạy trên nhiều cấu hình hệ thống khác nhau, bao gồm trung tâm phục vụ và máy tính mạng từ xa truy nhập tài nguyên điện thoại qua mạng. Trong cấu hình đầu tiên, một máy tính mạng đang chạy ứng dụng JTAPI và đang truy nhập những tài nguyên điện thoại qua một mạng được minh họa trong hình 6.12. Cấu hình thứ hai ứng dụng đang chạy trên một máy tính với những tài nguyên điện thoại riêng được minh họa trong hình 6.13.</p><h5><a name="_TOC_250006"></a>1.        Cấu hình máy tính mạng</h5><p>Trong cấu hình này, ứng dụng JTAPI hay Java applet chạy trên một trạm từ xa. Trạm làm việc này có thể là một máy tính nối mạng. Nó truy nhập tài nguyên mạng, sử dụng một trung tâm quản lý kỹ thuật điện thoại. JTAPI giao tiếp với bộ phận phục vụ này qua một cơ chế truyền thông từ xa, như RMI của Java, JOE hay một giao thức điện thoại nào đó. Cấu hình này đưwcj thể hiện như hình 6.10.</p><table><tbody><tr><td width="369"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.12. Cấu hình máy tính mạng</p><h5>2.   <a name="_TOC_250005"></a>Cấu hình desktop</h5><p>Trong cấu hình máy để bàn, ứng dụng JTAPI hay Java applet chạy trên cùng trạm làm việc.</p><p>Cấu hình desktop thể hiện như hình 6.13.</p><table><tbody><tr><td width="408"> </td></tr><tr><td> </td><td> </td></tr></tbody></table><p> </p><p>Hình 6.13: Cấu hình Máy để bàn</p><p> </p><p> </p><h4>III.   MỘT SỐ VÍ DỤ LẬP TRÌNH VỚI JTAPI</h4><p> </p><h5>1.   Ví dụ thiết lập một cuộc gọi điện thoại sử dụng phương thức Call.connect()</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyOutCallObserver class implements the CallObserver</li><li>interface and receives all events associated with the</li></ul><p>*/</p><p> </p><p>public class MyOutCallObserver implements CallObserver { public void callChangedEvent(CallEv[] evlist) {</p><p>for (int i = 0; i &lt; evlist.length; i++) { if (evlist[i] instanceof ConnEv) {</p><p>String name = null; try {</p><p>Connection connection = ((ConnEv)evlist[i]).getConnection(); Address addr = connection.getAddress();</p><p>name = addr.getName();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions</p><p>}</p><p>String msg = "Connection to Address: " + name + " is ";</p><p> </p><p>if (evlist[i].getID() == ConnAlertingEv.ID) { System.out.println(msg + "ALERTING");</p><p>}</p><p>else if (evlist[i].getID() == ConnInProgressEv.ID) { System.out.println(msg + "INPROGRESS");</p><p>}</p><p>else if (evlist[i].getID() == ConnConnectedEv.ID) { System.out.println(msg + "CONNECTED");</p><p>}</p><p>else if (evlist[i].getID() == ConnDisconnectedEv.ID) { System.out.println(msg + "DISCONNECTED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><h5>2.   Thực hiện cuộc gọi điện thoại từ một số tới một số</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*;</p><p> </p><p>import MyOutCallObserver; public class Outcall {</p><p>public static final void main(String args[]) {</p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>We need to get the appropriate objects associated with the</li><li>originating side of the telephone We ask the Address for a list</li><li>of Terminals on it and arbitrarily choose</li></ul><p>*/</p><p>Address origaddr = null; Terminal origterm = null; try {</p><p>origaddr = myprovider.getAddress("4761111");</p><p>/* Just get some Terminal on this Address */ Terminal[] terminals = origaddr.getTerminals(); if (terminals == null) {</p><p>System.out.println("No Terminals on Address."); System.exit(0);</p><p>}</p><p>origterm = terminals[0];</p><p>} catch (Exception excp) {</p><p>// Handle exceptions;</p><p>}</p><p>/*</p><p>* Create the telephone call object and add an observer.</p><p>*/</p><p>Call mycall = null; try {</p><p>mycall = myprovider.createCall(); mycall.addObserver(new MyOutCallObserver());</p><p>} catch (Exception excp) {</p><p>// Handle exceptions</p><p>}</p><p>/*</p><p>* Place the telephone call.</p><p>*/ try {</p><p>Connection c[] = mycall.connect(origterm, origaddr, "5551212");</p><p>} catch (Exception excp) {</p><p> </p><p>// Handle all Exceptions</p><p>}</p><p>}</p><p>}</p><p> </p><h5>3.   Ví dụ minh hoạ cuộc gọi điện thoại tới</h5><p><strong> </strong></p><p>import javax.telephony.*; import javax.telephony.events.*; import javax.telephony.*; import javax.telephony.events.*;</p><p>/*</p><ul><li>The MyInCallObserver class implements the CallObserver and</li><li>recieves all Call-related</li></ul><p>*/</p><p>public class MyInCallObserver implements CallObserver {</p><p> </p><p>public void callChangedEvent(CallEv[] evlist) { TerminalConnection termconn;</p><p>String name;</p><p>for (int i = 0; i &lt; evlist.length; i++) {</p><p> </p><p>if (evlist[i] instanceof TermConnEv) { termconn = null;</p><p>name = null;</p><p> </p><p>try {</p><p>TermConnEv tcev = (TermConnEv)evlist[i]; Terminal term = termconn.getTerminal(); termconn = tcev.getTerminalConnection(); name = term.getName();</p><p>} catch (Exception excp) {</p><p>// Handle exceptions.</p><p>}</p><p>String msg = "TerminalConnection to Terminal: " + name + " is "; if (evlist[i].getID() == TermConnActiveEv.ID) {</p><p>System.out.println(msg + "ACTIVE");</p><p>}</p><p>else if (evlist[i].getID() == TermConnRingingEv.ID) { System.out.println(msg + "RINGING");</p><p> </p><p>/* Answer the telephone Call using "inner class" thread */ try {</p><p>final TerminalConnection _tc = termconn; Runnable r = new Runnable() {</p><p>public void run(){ try{</p><p> </p><p>_tc.answer();</p><p>} catch (Exception excp){</p><p>// handle answer exceptions</p><p>}</p><p>};</p><p> </p><p>};</p><p>Thread T = new Thread(r); T.start();</p><p>} catch (Exception excp) {</p><p>// Handle Exceptions;</p><p>}</p><p>} else if (evlist[i].getID() == TermConnDroppedEv.ID) { System.out.println(msg + "DROPPED");</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>import javax.telephony.*; import javax.telephony.events.*; import MyInCallObserver;</p><p>/*</p><ul><li>Create a provider and monitor a particular terminal for an incoming</li></ul><p>*/</p><p>public class Incall {</p><p>public static final void main(String args[]) {</p><p> </p><p>/*</p><ul><li>Create a provider by first obtaining the default implementation of</li><li>JTAPI and then the default provider of that</li></ul><p>*/</p><p>Provider myprovider = null; try {</p><p>JtapiPeer peer = JtapiPeerFactory.getJtapiPeer(null); myprovider = peer.getProvider(null);</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Provider: " + excp.toString()); System.exit(0);</p><p>}</p><p>/*</p><ul><li>Get the terminal we wish to monitor and add a call observer to that</li><li>This will place a call observer on all call which come to</li><li>that We are assuming that Terminals are named after some</li><li>primary telephone number on</li></ul><p>*/ try {</p><p>Terminal terminal = myprovider.getTerminal("4761111"); terminal.addCallObserver(new MyInCallObserver());</p><p>} catch (Exception excp) {</p><p>System.out.println("Can't get Terminal: " + excp.toString()); System.exit(0);</p><p>}</p><p> </p><p>}</p><p>}</p><p> </p><p> </p><h5>4.   Ví dụ xây dựng dịch vụ RAS với thư viện JTAPI</h5><p>import java.awt.*; import java.awt.event.*; import javax.swing.*;</p><p>import javax.swing.event.*; import com.jpackages.jdun.*; import javax.swing.border.*;</p><p>public class Do_an extends JFrame {</p><p>public class DialNotify implements DialingNotification {</p><p>// Phuong thuc goi lai</p><p>public void notifyDialingState(String name, int state, int error) {</p><p>// Hien thi y nghia cua trang thai quay so moi</p><p>System.out.println("Tien trinh - " + name + ": (" + state + ") " + DialingState.getDialingStateString(state));</p><p>// Neu co loi thi hien thi y nghia cua ma loi if (error != 0) {</p><p>System.out.println("Loi:"+error+""+ dum.getErrorMessageForCode(error));</p><p>}</p><p>}</p><p>}</p><p>// handle cho minh hoa ve quan ly quay so (DialUpManager) DialUpManager dum;</p><p>// Minh hoa lop DialNotify (da dinh nghia o tren) ma co phuong thuc goi lai DialNotify dnot = new DialNotify();</p><p>// Dinh nghia giao dien do hoa JPanel contentPane;</p><p>BorderLayout borderLayout1 = new BorderLayout(); JPanel jPanel1 = new JPanel();</p><p>JPanel jPanel2 = new JPanel();</p><p>JScrollPane jScrollPane1 = new JScrollPane(); DefaultListModel lm = new DefaultListModel(); JList jList1 = new JList(lm);</p><p>JPanel jPanel3 = new JPanel();</p><p>BorderLayout borderLayout2 = new BorderLayout(); JButton jButtonConnect = new JButton();</p><p>JButton jButtonDisconnect = new JButton(); BorderLayout borderLayout3 = new BorderLayout(); JPanel jPanel4 = new JPanel();</p><p>JLabel jLabel1 = new JLabel();</p><p>JButton jButtonRefresh = new JButton(); JPanel jPanel5 = new JPanel();</p><p>FlowLayout flowLayout1 = new FlowLayout(); JButton jButtonDelete = new JButton(); JButton jButtonRename = new JButton(); JPanel jPanel6 = new JPanel();</p><p> </p><p>JCheckBox jCheckBox1 = new JCheckBox(); BorderLayout borderLayout4 = new BorderLayout(); JPanel jPanel9 = new JPanel();</p><p>JPanel jPanel7 = new JPanel();</p><p>JTextField jTextFieldUsername = new JTextField(); JLabel jLabel2 = new JLabel();</p><p>JPasswordField jPasswordField1 = new JPasswordField(); JPanel jPanel8 = new JPanel();</p><p>JLabel jLabel3 = new JLabel();</p><p>BorderLayout borderLayout5 = new BorderLayout(); BorderLayout borderLayout6 = new BorderLayout(); BorderLayout borderLayout7 = new BorderLayout(); JPanel jPanel10 = new JPanel();</p><p>JRadioButton jRadioButtonOverride = new JRadioButton(); JRadioButton jRadioButtonDefault = new JRadioButton(); JTextField jTextFieldPhoneNumber = new JTextField(); JLabel jLabel4 = new JLabel();</p><p>//Constructor public Do_an() {</p><p>try {</p><p>// minh hoa lop quan ly quay so (DialUpManager) dum = new DialUpManager(dnot);</p><p>}</p><p>catch (LibraryLoadFailedException e) {</p><p>if (e instanceof JDUNLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien JDUN...");</p><p>else if (e instanceof RASLibraryLoadFailedException) System.out.println("Khong the tai duoc thu vien RAS... ");</p><p>System.exit(0);</p><p>}</p><p>enableEvents(AWTEvent.WINDOW_EVENT_MASK); try {</p><p>jbInit(); initialize();</p><p>}</p><p>catch(Exception e) { e.printStackTrace();</p><p>}</p><p>}</p><p>// kich hoat kha nang ghi de username/password public void enableParams(boolean b) {</p><p>this.jTextFieldUsername.setEnabled(b); this.jTextFieldUsername.setEditable(b); this.jPasswordField1.setEnabled(b); this.jPasswordField1.setEditable(b);</p><p>}</p><p>// khoi tao he thong public void initialize() {</p><p>this.enableParams(false); System.out.println("Dang khoi tao...");</p><p> </p><p>ButtonGroup bg = new ButtonGroup(); bg.add(this.jRadioButtonDefault); bg.add(this.jRadioButtonOverride); this.refreshList();</p><p>}</p><p>// Danh sach JList</p><p>public void refreshList() { lm.clear();</p><p>try {</p><p>// Tim nap ten</p><p>String[] names = dum.getEntryNames(); for (int i=0; i &lt; names.length; i++) {</p><p>lm.addElement(names[i]);</p><p>}</p><p>this.jList1.repaint();</p><p>}</p><p>catch (Exception e) {}</p><p>}</p><p>//Khoi tao cac thanh phan</p><p>private void jbInit() throws Exception { contentPane = (JPanel) this.getContentPane(); contentPane.setLayout(borderLayout1); this.setSize(new Dimension(500, 400));</p><p>this.setTitle("Chuong trinh minh hoa <a href="mailto:JDUNPhamHienTN2008@yahoo.com">JDUNPhamHienTN2008@yahoo.com</a>"); jPanel1.setLayout(borderLayout2);</p><p>jScrollPane1.setPreferredSize(new Dimension(660, 80));</p><p>jPanel1.setPreferredSize(new Dimension(260, 100));</p><p>jButtonConnect.setPreferredSize(new Dimension(105, 24)); jButtonConnect.setText("Ket noi"); jButtonConnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonConnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonDisconnect.setPreferredSize(new Dimension(105, 24)); jButtonDisconnect.setText("Ngat ket noi"); jButtonDisconnect.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonDisconnect_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel2.setLayout(borderLayout3); jLabel1.setText("Nhap ten quay so"); jButtonRefresh.setPreferredSize(new Dimension(79, 24)); jButtonRefresh.setText("Lam lai");</p><p>jButtonRefresh.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonRefresh_actionPerformed(e);</p><p>}</p><p>});</p><p> </p><p>jPanel5.setPreferredSize(new Dimension(70, 28)); jPanel5.setLayout(flowLayout1); flowLayout1.setVgap(2); jButtonDelete.setPreferredSize(new Dimension(60, 24));</p><p>jButtonDelete.setMargin(new Insets(0, 0, 0, 0)); jButtonDelete.setText("Xoa");</p><p>jButtonDelete.addActionListener(new java.awt.event.ActionListener() { public void actionPerformed(ActionEvent e) {</p><p>jButtonDelete_actionPerformed(e);</p><p>}</p><p>});</p><p>jButtonRename.setPreferredSize(new Dimension(70, 24));</p><p>jButtonRename.setMargin(new Insets(0, 0, 0, 0)); jButtonRename.setText("Doi ten"); jButtonRename.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jButtonRename_actionPerformed(e);</p><p>}</p><p>});</p><p>jPanel6.setBorder(BorderFactory.createEtchedBorder()); jPanel6.setLayout(borderLayout4); jCheckBox1.addActionListener(new java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jCheckBox1_actionPerformed(e);</p><p>}</p><p>});</p><p>jList1.addListSelectionListener(new javax.swing.event.ListSelectionListener() {</p><p>public void valueChanged(ListSelectionEvent e) { jList1_valueChanged(e);</p><p>}</p><p>});</p><p>jTextFieldUsername.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Nguoi dung"); jPasswordField1.setPreferredSize(new Dimension(200, 24));</p><p>jLabel2.setPreferredSize(new Dimension(65, 17)); jLabel2.setText("Mat khau"); jPanel9.setLayout(borderLayout5); jPanel8.setLayout(borderLayout7); jPanel7.setLayout(borderLayout6); jRadioButtonOverride.setText("Ghi de"); jRadioButtonOverride.addActionListener(new</p><p>java.awt.event.ActionListener() {</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonOverride_actionPerformed(e);</p><p>}</p><p>});</p><p>jRadioButtonDefault.setSelected(true); jRadioButtonDefault.setText("Mac dinh");</p><p> </p><p>jRadioButtonDefault.addActionListener(new java.awt.event.ActionListener()</p><p>{</p><p>public void actionPerformed(ActionEvent e) { jRadioButtonDefault_actionPerformed(e);</p><p>}</p><p>});</p><p>jTextFieldPhoneNumber.setPreferredSize(new Dimension(120, 24)); jTextFieldPhoneNumber.setEditable(false);</p><p>jLabel3.setText("So dien thoai"); contentPane.add(jPanel1, BorderLayout.CENTER); jPanel1.add(jScrollPane1, BorderLayout.CENTER); jPanel1.add(jPanel3, BorderLayout.NORTH); jPanel2.add(jPanel4, BorderLayout.CENTER); jPanel3.add(jLabel1, null); jPanel3.add(jButtonRefresh, null); jPanel2.add(jPanel5, BorderLayout.SOUTH); jPanel5.add(jButtonDelete, null); jPanel5.add(jButtonRename, null); jPanel1.add(jPanel6, BorderLayout.SOUTH); jPanel6.add(jCheckBox1, BorderLayout.WEST); jPanel6.add(jPanel9, BorderLayout.CENTER); jPanel8.add(jLabel3, BorderLayout.WEST); jPanel8.add(jPasswordField1, BorderLayout.CENTER); jPanel9.add(jPanel8, BorderLayout.SOUTH); jPanel9.add(jPanel7, BorderLayout.NORTH); jPanel7.add(jLabel2, BorderLayout.WEST); jPanel7.add(jTextFieldUsername, BorderLayout.CENTER); jPanel6.add(jPanel10, BorderLayout.SOUTH); jPanel10.add(jLabel4, null); jPanel10.add(jRadioButtonDefault, null); jPanel10.add(jRadioButtonOverride, null); jPanel10.add(jTextFieldPhoneNumber, null); jScrollPane1.getViewport().add(jList1, null); contentPane.add(jPanel2, BorderLayout.SOUTH); jPanel2.add(jButtonConnect, null); jPanel2.add(jButtonDisconnect, null);</p><p>}</p><p>//Kha nang ghi de nho the ta co the thoat khi cua so duoc dong protected void processWindowEvent(WindowEvent e) {</p><p>super.processWindowEvent(e);</p><p>if (e.getID() == WindowEvent.WINDOW_CLOSING) { System.exit(0);</p><p>}</p><p>}</p><p>// Cap nhat lai JList</p><p>void jButtonRefresh_actionPerformed(ActionEvent e) { this.refreshList();</p><p>}</p><p>// Ket noi toi doi tuong da chon</p><p>void jButtonConnect_actionPerformed(ActionEvent e) {</p><p> </p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap so dien thoai ghi de String phonenum = null;</p><p>if (this.jRadioButtonOverride.isSelected()) { phonenum = this.jTextFieldPhoneNumber.getText();</p><p>}</p><p>if (!jCheckBox1.isSelected()) {</p><p>// Quay so voi username/password mac dinh if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName);</p><p>}</p><p>else {</p><p>dum.dialEntryAsynchronous(entryName, phonenum);</p><p>}</p><p>}</p><p>else {</p><p>// Lay username/password ghi de va su dung chung de quay so String username = this.jTextFieldUsername.getText();</p><p>String password = new String(this.jPasswordField1.getPassword()); if (phonenum == null) {</p><p>dum.dialEntryAsynchronous(entryName, username, password);</p><p>}</p><p>else { dum.dialEntryAsynchronous(entryName,username,password,"",phonenum);</p><p>}</p><p>}</p><p>}</p><p>// Ket thuc cuoc goi da chon</p><p>void jButtonDisconnect_actionPerformed(ActionEvent e) {</p><p>final String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return; dum.hangUpEntry(entryName);</p><p>}</p><p>// Xoa doi tuong duoc chon</p><p>void jButtonDelete_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Xac nhan xoa</p><p>Int eply=JOptionPane.showConfirmDialog(this,"Ban co chac chan muonxoa"+entryName+"khong?"Chuy...",JOptionPane.YES_NO_OPTION,JOptionPane.PLAI N_MESSAGE);</p><p>if (reply == JOptionPane.NO_OPTION) { return;</p><p>}</p><p>// Da xac nhan vi the xoa doi tuong dum.deleteEntry(entryName);</p><p> </p><p>// Cap nhat danh sach(JList) sau khi doi tuong da duoc xoa this.refreshList();</p><p>}</p><p>// Doi ten doi tuong duoc chon</p><p>void jButtonRename_actionPerformed(ActionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Doi ten moi</p><p>String message = "Nhap ten moi '" + entryName + "'";</p><p>String newname = (String) JOptionPane.showInputDialog(this, message, "Doi ten", JOptionPane.PLAIN_MESSAGE, null, null, entryName);</p><p>if (newname == null) return;</p><p>if (newname.equals(entryName)) return;</p><p>// DOi ten bat ky doi tuong nao sang ten moi dum.renameEntry(entryName, newname);</p><p>// Cap nhat lai danh sac (JList) sau khi doi tuong duoc chon da duoc doi</p><p> </p><p>ten</p><p> </p><p>}</p><p> </p><p>this.refreshList();</p><p> </p><p>void jCheckBox1_actionPerformed(ActionEvent e) { if (jCheckBox1.isSelected())</p><p>this.enableParams(true); else</p><p>this.enableParams(false);</p><p>}</p><p>// Khi mot danh sach cac lua chon duoc tao ra thi nap username/password thich hop.</p><p>void jList1_valueChanged(ListSelectionEvent e) {</p><p>String entryName = (String) this.jList1.getSelectedValue(); if (entryName == null)</p><p>return;</p><p>// Tim nap username/password</p><p>String password = dum.getPassword(entryName); String username = dum.getUsername(entryName);</p><p>// Hien thi username/password this.jTextFieldUsername.setText(username); this.jPasswordField1.setText(password);</p><p>// Tim nap cac thuoc tinh doi tuong</p><p>DialUpEntryProperties props = dum.getDialUpEntryProperties(entryName);</p><p>// Hien thi so dien thoai</p><p>if (props.getUseCountryAndAreaCodes()) { String areacode = props.getAreaCode();</p><p>String phonenum = props.getLocalPhoneNumber(); this.jTextFieldPhoneNumber.setText(areacode + phonenum);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setText(props.getLocalPhoneNumber());</p><p> </p><p>}</p><p>}</p><p>void phoneButtonChange() {</p><p>if (this.jRadioButtonDefault.isSelected()) { this.jTextFieldPhoneNumber.setEditable(false);</p><p>}</p><p>else {</p><p>this.jTextFieldPhoneNumber.setEditable(true);</p><p>}</p><p>}</p><p>void jRadioButtonDefault_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>void jRadioButtonOverride_actionPerformed(ActionEvent e) { phoneButtonChange();</p><p>}</p><p>//Phuong thuc chinh</p><p>public static void main(String[] args) { Do_an frame = new Do_an();</p><p>//Can giua cho cua so</p><p>Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); Dimension frameSize = frame.getSize();</p><p>if (frameSize.height &gt; screenSize.height) { frameSize.height = screenSize.height;</p><p>}</p><p>if (frameSize.width &gt; screenSize.width) { frameSize.width = screenSize.width;</p><p>}</p><p>frame.setLocation((screenSize.width       -frameSize.width)                              /                                             2, (screenSize.height - frameSize.height) / 2);</p><p>frame.setVisible(true);</p><p>}</p><p>}</p><h4>V. KẾT LUẬN</h4><p>Trong chương nay chúng ta đã khảo sát gói thư viện JTAPI và kỹ thuật lập trình với nó. Qua chương này sinh viên nắm được cấu trúc của thư viện JTAPI, các khái niệm, mô hình và cách cài đặt chương trình với các cuộc gọi điện thoại đơn giản. Trên cơ sở đó sinh viên có thể phát triển các chương trình ứng dụng thực tế như dịch vụ truy cập từ xa RAS, hội thảo trực tuyến và các công nghệ liên qua đến IP khác, nhất là các dịch vụ trên hệ thống điện thoại doanh nghiệp(ET: Enterprise Telephony).</p></div><footer class="content__footer"><div class="entry-wrapper"><p class="content__updated">This article was updated on December 26, 2024</p><div class="content__actions"><div class="content__share"><button class="btn--icon content__share-button js-content__share-button"><svg width="20" height="20" aria-hidden="true"><use xlink:href="https://github.com/conglam03/myblog.git/assets/svg/svg-map.svg#share"></use></svg> <span>Share It</span></button><div class="content__share-popup js-content__share-popup"></div></div></div><div class="content__bio bio"><div><h3 class="h4 bio__name"><a href="https://github.com/conglam03/myblog.git/authors/conlam03/" rel="author">conlam03</a></h3></div></div></div><nav class="content__nav"><div class="wrapper"><div class="content__nav-inner"><div class="content__nav-prev"><a href="https://github.com/conglam03/myblog.git/bai-5-ky-thuat-lap-trinh-phan-tan-doi-tuong-rmi.html" class="content__nav-link" rel="prev"><div><span>Previous</span> Bài 5: KỸ THUẬT LẬP TRÌNH PHÂN TÁN ĐỐI TƯỢNG RMI</div></a></div><div class="content__nav-next"><a href="https://github.com/conglam03/myblog.git/bai-7-lap-trinh-mang-an-toan-bao-mat-voi-ssl.html" class="content__nav-link" rel="next"><div><span>Next</span> Bài 7: LẬP TRÌNH MẠNG AN TOÀN BẢO MẬT VỚI SSL</div></a></div></div></div></nav></footer></article><div class="content__related related"><div class="wrapper"><h2 class="h4 related__title">You should also read:</h2><article class="feed__item feed__item--centered"><div class="feed__content"><header><div class="feed__meta"><a href="https://github.com/conglam03/myblog.git/authors/conlam03/" class="feed__author">conlam03</a> <time datetime="2024-12-26T13:32" class="feed__date">December 26, 2024</time></div><h3 class="feed__title"><a href="https://github.com/conglam03/myblog.git/bai-7-lap-trinh-mang-an-toan-bao-mat-voi-ssl.html">Bài 7: LẬP TRÌNH MẠNG AN TOÀN BẢO MẬT VỚI SSL</a></h3></header><p>GIỚI THIỆU SSL VÀ MỘT SỐ KHÁI NIỆM Trong các giao dịch điện tử trên mạng và trong các giao dịch thanh toán trực tuyến, thông tin/dữ liệu trên môi trường mạng Internet không an toàn thường được bảo đảm bởi cơ chế bảo mật&hellip;</p><a href="https://github.com/conglam03/myblog.git/bai-7-lap-trinh-mang-an-toan-bao-mat-voi-ssl.html" class="readmore feed__readmore">Continue reading...</a></div></article><article class="feed__item feed__item--centered"><div class="feed__content"><header><div class="feed__meta"><a href="https://github.com/conglam03/myblog.git/authors/conlam03/" class="feed__author">conlam03</a> <time datetime="2024-12-26T13:16" class="feed__date">December 26, 2024</time></div><h3 class="feed__title"><a href="https://github.com/conglam03/myblog.git/bai-5-ky-thuat-lap-trinh-phan-tan-doi-tuong-rmi.html">Bài 5: KỸ THUẬT LẬP TRÌNH PHÂN TÁN ĐỐI TƯỢNG RMI</a></h3></header><p>GIỚI THIỆU LẬP TRÌNH PHÂN TÁN VÀ RMI (Remote Method Invocation) Kỹ thuật lập trình phân tán thực chất là kỹ thuật lập trình phân tán mã lệnh hay đối tượng. Nó cho phép phân bố tải lên toàn mạng để tận dụng tài nguyên&hellip;</p><a href="https://github.com/conglam03/myblog.git/bai-5-ky-thuat-lap-trinh-phan-tan-doi-tuong-rmi.html" class="readmore feed__readmore">Continue reading...</a></div></article><article class="feed__item feed__item--centered"><div class="feed__content"><header><div class="feed__meta"><a href="https://github.com/conglam03/myblog.git/authors/conlam03/" class="feed__author">conlam03</a> <time datetime="2024-12-26T13:12" class="feed__date">December 26, 2024</time></div><h3 class="feed__title"><a href="https://github.com/conglam03/myblog.git/bai-4-lap-trinh-voi-giao-thuc-dich-vu-mang-phia-client.html">Bài 4: LẬP TRÌNH VỚI GIAO THỨC DỊCH VỤ MẠNG PHÍA CLIENT</a></h3></header><p>I. GIỚI THIỆU Chương này sẽ hướng sinh viên sử dụng kỹ thuật lập trình socket đã được trang bị trong các chương trước để lập trình với một số giao thức dịch vụ mạng phổ biến trên internet như: DSN, Telnet, FTP, TFTP, SMTP,&hellip;</p><a href="https://github.com/conglam03/myblog.git/bai-4-lap-trinh-voi-giao-thuc-dich-vu-mang-phia-client.html" class="readmore feed__readmore">Continue reading...</a></div></article></div></div></main><footer class="footer footer--glued"><div class="wrapper"><div class="footer__copyright">Powered by Publii</div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://github.com/conglam03/myblog.git/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://github.com/conglam03/myblog.git/assets/js/scripts.min.js?v=700105c316933a8202041b6415abb233"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>